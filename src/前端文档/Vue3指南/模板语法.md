---
sort: 3
---

# 模板语法

## v-model

Vue2 中每个组件只允许定义一个 `v-model` ，默认的属性名为 `value` 、事件名为 `input` ，可以在 `model` 选项中重新定义名称

::: details Vue2 v-model

father.vue

```vue-html
<Child v-model="someValue" />
<!-- 相当于 -->
<Child :value="someValue" @input="someValue = $event" />
```

child.vue

```vue
<script>
export default {
  model: {
    prop: 'value',
    event: 'input'
  }
}
</script>

<template>
  <input :value="value" @input="$emit('input', $event.target.value)">
</template>
```

:::

Vue2 还可以使用 `.sync` 修饰符实现双向绑定，子组件中需要通过 `update:prop` 事件修改属性值

::: details Vue2 .sync
father.vue

```vue-html
<Child :title.sync="someValue" />
<!-- 相当于 -->
<Child :title="someValue" @update:title="someValue = $event" />
```

child.vue

```vue-html
  <input :value="title" @input="$emit('update:title', $event.target.value)">
```

:::

<hr />

在 Vue3 中，对两种双向绑定方式进行了合并，全部改用 `v-model` 实现。默认的属性名变更为 `modelValue` 、事件名变更为 `update:modelValue` ，并且新增了自定义修饰符的功能

如果使用的是 `3.4` 之后的版本，推荐使用 `defineModel` 宏，`defineModel` 宏是对 `props + emits` 方式的语法糖封装，可以直接对 `defineModel` 创建的变量进行修改

<IframeContainer title="Vue3 双向绑定" src="https://play.vuejs.org/#eNqtVd2O20QUfpWRL2pHBIdVkUDGCSxlJYroUpXCDebCdSZZt86MmRlnF6JICJULBKiVoCAtqHBXJMRPVS6aUvVp1ql61VfomTP+maTd3WrVm8Q+f/Odb75zPHM289yfFtQJnFAmIs0VkVQVOcliNu5HjpKRM4hYOsm5UGRGBB2RORkJPiEupLlvNL536Chl9Bwf0qzy+71ha9OHWNHnBc/lJhtuTVIlm/jctmJGxCKWcCYViceU9PX5ISsml6gYeJ3axeJJ5fNcF6xhz7QCwOFF0UmexYrCGyEWokC/hzbs6csT/Q9tw2GRU78Hur6fxHmq4iz9goJfWyCghycQsoLb1F1t8MSVw53TA0gJZjP4nc/DHrzXdh0KDv3XeMKe1a7ThfsDikbp2L8sOYNLnunkyEn4JE8zKj7IVQoURk5A0KN9cZbx3ffQpkRBu7U92aHJlWfYL8s9bYuc84JKKqYAv/GpWIypMu6tD7fpHjw3TqCgyCD6COcFKnlWaIwm7O2CDQG2FYdoz6KoUja+KLf2FGWybkoD1ZFzjI8ckNSZI1pv4Z72X8W8iM2BxTUdHzMsvR4pr321vPHv8qdFef9a+ff+weKbh7f/L29+WysWb//jOCu0bq3qHkJRn+c0INsocwQOEXGRqYBsvI7vU1DLMFZcePBU0E7dgQA0gmE+H+koXb/fJ64ZGZecOlVZB2TjtbpBmBgEvbzzC0A8HPQnWmldnDYAm45SKuSnq/hDqQRcQ5e4rajdgefqHLdrYAr6WZEKOrRkBCyudZKOiLdykDUlTVDTMOb6yU4sNpX3SsdX/KM8p+JMLKnXIS9VfpmlCfU2oF2dCp2vV1gnxGqMVITsXzVXe7D4rfzu6/L6n+Wvf5jxJwd3/6qZMoaaGVwFelsdsZfCHP8IKW/9UF7//vH9/TBleaGszWFtBojvmYQ2b/HfowdX2zytAZ2EF99uHDC12ju8GjYAxWazqpc50mXi1nfMU1v7+Pmwpbb8+fflnRuGX0MusNxKfJ3T3VTtwNLW8yC9dqUjyWEljLbFNwNiKKgWBu5MUqm0NTUyg/gLNOFi2Cj5EucZjdmgigbw1vCW/yzKez9qvGA0FUh5++byy1sHd++ZwKY0qgu+WljoKaDNbK8BCggouD8g3mxuMuEiUJ+GFYqfl1ppeAOGBA8qukUOFNKgPQVmUH9NKk46AZnydIhl7fhqWm2u2lDdgj5/VLBEb1DC2TYEntWq00XwYWtKmarmNKPNF9qjvlmxJJbk3Yvn3jfBGZ3ocL8ZQj39eN/+sTugqmw+pIcuAHTb849yRvK8Z3QNIRCw0uPm+IgWVwut0P08LWtXwa4wvsv0Y3U5iOEkKyPAou3GeAvN8G7d1MkXSVN9ZY9YZ9RMvZDtMn8Cpz7ZKA==" />

## v-if 和 v-for

Vue2 中 `v-for` 的优先级高于 `v-if`，可以在 [Vue Template Explorer](https://v2.template-explorer.vuejs.org/) 中查看 template 对应的编译结果：

<IframeContainer title="Vue2" src="https://v2.template-explorer.vuejs.org/#%3Cdiv%3E%0A%20%20%3Cspan%20v-for%3D%22item%20of%203%22%20%3Akey%3D%22item%22%20v-if%3D%22item%22%3E%3C%2Fspan%3E%0A%3C%2Fdiv%3E" />

从编译结果可以看出，无论 `v-if` 条件是否成立，循环和判断语句始终会执行，造成性能浪费。所以并不推荐 `v-for` 与 `v-if` 一起使用

<hr />

Vue3 中 调整为 `v-if` 优先级高于 `v-for`，可以在 [Vue SFC Playground](https://play.vuejs.org/) 中查看编译结果：

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNp9UT1PwzAQ/SvWzW0YyhSFSoA6wAAIGL1E6SW4dWzLHyEo8n/n7NDQoep278Pv3skT3BtTDAGhhMo1VhjPHPpgtlxVNzNBIwGPvZG1R0KMVc7Uig3rVts7DoI0plu24cDKI/78UYSGtWgXtJ0mlq0xUjQF5B1nubAC7xqtWtEVB6cVdZrSNg6N7o2QaF+NF1o5DiXLStJqKfX3c+a8Dbg68c0XNscL/MGNiePwZtGhHZDDovnaduhneffxgiPNi9jrfZDkviK+o9MypI6z7SGoPdU+8+W2T73R1gvVfbrd6FG501GpaHLG7OdAH/N45fT/upviNr/jKkL8BWhjmnM=" />

右侧面板切换到 JS 编译结果可以看出 Vue3 中将 `v-if` 提升到了 `v-for` 的外层，这会减少不必要的运行次数，但是也导致 `v-if` 中无法访问到 `v-for` 创建的变量，所以上面的例子中 `v-if` 处会报错，且不会有任何元素渲染

<hr />

Vue3 与 Vue2 在 `key` 的使用上也有差别。Vue2 在 `template` 标签上使用 `v-for` 时，`key` 应该写在子元素上，如果有多个子元素则每个子元素都需要添加 `key`

而 Vue3 中 `template` 标签使用 `v-for` 时， `key` 只需要绑定在 `template` 上即可

::: details Vue2

```vue-html
<template v-for="item of someList">
  <Child1 :key="item.id" />
  <Child2 :key="item.id" />
</template
```

:::

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNp9kcFOwzAQRH/F2nNphMopCpEA9QAHQMDRlyjdpG4d27LXISjKv2M7NBQJ9eaZebualUe4M2bde4QcCldbYYg5JG/KIptlyRVXBWFnZEUYFGOLYv1Vo+0tBxEcphu24cDyI379WBwSHyb21+U4soRNU5EFmRZlZ3v/CFgBuVqrRrTrg9Mq1BvjBIdad0ZItC+GhFaOQ85SErNKSv35lDyyHlcnv95jffzHP7ghehxeLTq0PXJYMqpsizTH2/dnHMJ7CTu98zLQF8I3dFr62HHG7r3ahdpnXGr72BltSaj2w20HQuVOR8WikZwSzyH80cOF03/rbtY3aY6rCaZv66+dLA==" />

在右侧面板的 JS 编译结果中可以看出，绑定在 template 上的 key，会编译为绑定在元素上

## v-bind

Vue2 中 `v-bind` 绑定一个对象时，如果标签上有同名的单独绑定，那么始终会使用这个单独的绑定值

```vue-html
<!-- 结果为 id=1 -->
<Comp :id="1" v-bind="{id: 2}" />
```

Vue3 调整了这个行为，现在完全按照标签中的绑定顺序决定最终的绑定值。如果使用的 `Vue 3.4+` 版本，还提供了绑定的同名简写形式

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNqFUk1PwzAM/StRLh3SaMXgVLpJgHaAA0zAMZfSul1Hm0T5KJOq/HecdBvTxODU2u/5+dnOQO+kjHsLNKWZLlQjDdFgrFww3nRSKEMGoqAijlRKdCRCanR7wB5EJ3dAnPjAS3mc8UJwbUiftxbI3EtMoqvogvEsGdtgAwwMdLLNDWBESBbk0lAzZzR8GSX95UfDS0wMIZOSaBY5zCdHRec4O7XAzZKjbnRKjUaPVVPHGy04zj94OUYL1GtaUC/SNDgDoykJiMfythVfTyFnlIXpPl+sofj8Jb/RW59jdKVAg+pxnANmclWDGeHl2zNs8f8AdqK0LbL/AF9Bi9Z6jyPt3vISbR/xgtvHcKmG1+96uTXA9X4ob9QzXeDjui34VZ4b/cfudXwT6hh3uMX91U8fEGlzXuNBDMrgvkuoGg4rJaTOdjfSRqEtt5j88yrWs8UwljiXJRidntJ9A9YG7PA=" />

## v-on

Vue2 中想在组件上绑定一个原生事件时，需要添加 `.native` 修饰符，如果不添加会被当做组件自定义事件

Vue3 中移除了 `v-on.native` 修饰符，现在未在组件内进行声明的事件会直接被当作原生事件处理

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNqFUrlOAzEQ/ZWRm4CCEiGowhJxiAIKQEDpZtlMwoLXtnyESNE2VCBoaBENv0CBxPE5KJT8AmPnIIo4qt2Z9+Z5Zt702brWta5H1mCJzUyuHVh0Xje5zAutjIM+GGxDCW2jCqgQtTKBNlWhR/laPQRBqbLCJZeZktZBNxUeYTUozC3Oc5nUh2+QOgUOCy1ShxQBJFGsMaxYy0Sena1yFsNqlTOoEyupT5WwBeYsPdPOO7VTqyRN0A9CnGWklAs0e9rl1AZnDYhIwFIh1PlOzDnjcWGcz04wO/shf2p7IcfZvkGLpoucTTCXmg66Ibx1uIs9+p+AhWp5Qew/wAO0SvjQ45C24WWL2p7ixW6347Jz2TmyWz2H0o6HCo0GZhn5tCyPYYm/jf7d7lJtOdZxWdIWx8bNngCIVHbIA0cytO8WtnOJ+0ZpCwldRbSmAdIXx2joPpow94/DVqey+XHxPLi8rS5+vt3Qd/D4MLi/im6/v1y/vz59vt31R9pQlqQWamadL78ADvjzHA==" />

## $attrs

Vue3 中移除了 `$listeners`，现在事件只是 `$attrs` 中以 `on` 开头的属性

Vue2 与 Vue3 均可以设置 `inheritAttrs` 选项为 `false`，然后手动将未在 `props` 或 `emits` 中定义的属性和事件应用到根元素之外的元素上。但是 Vue2 中 `class` 和 `style` 并不包含在 `$attrs` 中

Vue3 改变了这一点，`$attrs` 包含了 `class` 和 `style` ，可以随其他属性一起绑定到非根元素上

Vue3 模板中可以直接使用 `$attrs` ，如果要在 script 中使用，需要通过 `useAttrs` 方法获取

::: details Vue2
Child.vue

```vue
<script>
export default {
  inheritAttrs: false
}
</script>

<template>
  <div>
    <input v-bind="$attrs" v-on="$listeners">
  </div>
</template>
```

father.vue

```vue
<template>
  <Child class="foo" style="color: red" value="123" @input="onInput" />
  <!--
   相当于：
   <div class="foo" style="color: red">
    <input value="123" @input="onInput">
  </div>
   -->
</template>
```

:::

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNqNUk1vEzEQ/SsjC6mp1Owe4LSkiIJyKAdAwNGX7e5k4+IdW/Z4GxTlvzP2JiFIUPXmeW8+3ozfXt15X00JVaNWsQvGM0Tk5MG2NNxqxVGrd5rM6F1g+OhGD5vgRriq6hzk0qu3mjRtEnVsHIGje/KJF9hAeawnJL6GvSaAzlF0FivrhgVeazpoWtXzWBkiAePobcsoEcCqjOtsG2NWgjtePjjbawWRf1kUrHPWhQYCZnBqbcrgFq11Er83ebwAR0UC1dJ3VV8MkbD0gtg5j70g1XnOLHnjiJdPaIYtN5Bh2XaWneukQN3IkWSxjRmqx+hILlkKs7rRG4vhi8+HkUM2c8vMtaLx6VPBOCS8OeHdFruf/8Af4y5jWn0NGDFMqNWZ4zYMKOtlev39s+i/IEfXJyvZz5DfUD4lZY1z2odEvci+yCtq74sHDA0/4nrHSPG0VBaaMw8lXyvxRP65/63+R+7r6k2pk4vKFU9+epkV95Ai3jGHCIejJc9ezDZjaAt5e85biOEuDVh4wZ5zYG+m8pBncRNMywdDvah5VcqPnhK6nlP/cpc6/Abx4yZQ" />

::: info
在浏览器中直接打印 Vue 的响应式值时，不容易阅读。可以开启 **浏览器开发者工具-设置-控制台选项** 中的 **自定义格式化程序（`Custom formatters`）**

之后打印便会使用 Vue 提供的格式化程序进行显示，更容易阅读
:::

## 按键修饰符

Vue2 中键盘事件可以用 `KeyCodes` 和自定义按键别名修饰符来改变事件监听行为

随着 [KeyboardEvent.keyCode](https://developer.mozilla.org/zh-CN/docs/Web/API/KeyboardEvent/keyCode) 被废弃，Vue3 中改为直接使用 `kebab-cased` 格式的按键名称作为修饰符

对于语法限制导致无法被匹配的键，比如 `"`、`'`、`/`、`=`、`>`、`.`、`。` 等，应该在监听器内使用 `event.key` 代替

::: details Vue2

```vue-html
<!-- 键码版本 -->
<input v-on:keyup.13="submit" />

<!-- 别名版本 -->
<input v-on:keyup.enter="submit" />
```

```js
Vue.config.keyCodes = {
  f1: 112
}
```

:::

<IframeContainer title="Vue3" src="https://play.vuejs.org/#eNp9UktqG0EQvUrRm7GJGREnKyGFfNAiCeS/7M1kpiSP3VPd6s9ERmgTQsDY4I0P4ZXXxr6OEPgWrumRxjYIr7r7vVdVr6p6Lt4Zk9YBRV8MXG5L48GhDwZURpOhFN5J8UZSWRltPczB4hgWMLa6goTDEkmSck3OQ52pgC9h2Eh2kmT3Cb7/GJc0DpT7UhNo+ozHwexgn8/fOrPFqEbyu3NJsI5M48Hxyerv5ersZHl9urz5n8ALwPQIjyUtJA16rXd2yg+PlVGZR34BDEoywUM/ZuGGWptSAEtyPNCqQMswJ4Zp7zvjbzlpMOm00w6fFIZpwqJem7so6811W5n9bWWWt7erf+d3F1ddLcbXc1hnHvS6FsQer4AHOS4n6aHTxHuKs5Ei15UpFdqvppkkr6kPkWm4TCn951PEvA24t8HzA8yPtuCHbtZgUnyz6NDWKEXH+cxO0Lf06OcXnPG9IytdBMXqZ8gf6LQKjcdW9j5QwbYf6aLbj/GHlTT55UYzj+Q2TTVGG+Ui6nmyAT880/qD3Vfp6xjHP0Qs7gHd1ATW" />
