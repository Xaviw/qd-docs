---
sort: 2
---

# 组合式语法

## setup 方法

Vue3 的组合式 API 只能在 `setup` 中使用，使用方式包括选项式语法 `setup` 方法，和更方便的 `<script setup>` 语法

选项式语法 `setup` 方法需要与其他选项式语法结合使用，例如 `name`、`props` 等，使用方式都与 Vue2 中一致

但是因为 `setup` 方法中没有 `this`，所以访问以及操作组件需要通过 `setup` 方法的参数实现

第一个参数 `props` 对应组件参数对象，第二个参数为上下文对象 `context`，其中包括 ：

- `emit` 方法：对应 Vue2 的 `$emit` 方法
- `attrs` 对象：对应所有未在 `props` 和 `emits` 中定义的属性和方法（包括 `class` 和 `style`）
- `expose` 方法：`setup` 是封闭的，只有 `expose` 暴露出的属性和方法才能通过引用访问（`ref`）
- `slots` 对象：所有传入的插槽，包括未定义的

选项式语法 `setup` 方法缺点是组件需要手动注册，以及只有方法中 `return` 的值才能在 `template` 中使用

<IframeContainer title="选项式语法中的 setup 方法" src="https://play.vuejs.org/#eNqVVM1y0zAQfhWNOTidyTgD5RRcQ8v0UA7A0N4wB8fZBLeyJCQ5pBP87uyu7NQOIdAcIu/Pt9q/T7vo0phk00A0j1JX2sp4IQu1vsgj7/Ioy1VVG229eK9rI1ZW1yJOZiQQKH6zt++EhZVoOxey5SpXsGXjElZFI9EpV0KUCNYKlHdzRHHcdkoGB74xk7PgRX7KefYWFxQ8vUG5UCXcPRpIPf7pFcMz8UuoRspsQv9nAW0xmFV4AQdoSUm34Ec6C3VibSh4qI0sPKAkRMrZ4F1YPuHySPjKS6Bu0ImyKmoS6UDpXf14vcFSUIOJX2R4X0vqUlblw1jJF+AV/YXiRdeVzoAmZwqVvcT86OzcZ6MER3gntb88QL96FvrqAH1+Cp3y2LlrKJiMGpQUOMPQ47dJIdo2nZHHk30xsC/29kHkaIqLhqNeVevk3mmFe8jzDwOoJNhPxle4CnmEoUJieVRIqX9+YJ23DfD6MOY7lA9H9PduS7o8+mzBgd3g7PY2X9g1+GC+vv0IW/zeG2u9bGjuJ4xfwGnZUI7B7apRS0x74MfZ3jBPKrW+c9dbD8r1RVGi/XqSN3KHGv230p/SPU9eMw63GrvYc/JfRP6TqEji40ylJZ+L2IPzMSdnrDbMWmYDfyAN5+LWWyxsipF/NJWFZSgKLwk1QV0R2b/GHVvibwO+c8ypKP12xHwtIZF6PTQPn4UivAmTuIhH+kWvX+z1fptQcQ4mO4S1h+8Dqv7zcVhWm54ZYcnp13Ui8AdXnWVe9BGTet6MsH2ziYoUAo8McXScxDHxO0D/ILEO53wET2fIfci79jfjNfAt" />

<hr />

因为选项式语法 `setup` 方法的不方便，通常我们使用 `<script setup>` 来使用组合式 API

`<script setup>` 是选项式语法 `setup` 方法的语法糖，可以简化一些操作，包括：

1. 顶层绑定会自动暴露给模板，无需 return
2. 导入的内容也会自动暴露给模板，如果是组件会自动注册
3. 本地自定义指令无需注册，只需要符合 `vNameOfDirective` 命名规范（导入的指令可以通过重命名实现）

::: info
如果组件对象通过属性嵌套了其他组件（例如 AntDesignVue Form 组件），需要显式引入每个组件，或者 `import *`

```vue
<script setup>
import Form, { Item } from 'ant-design-vue'
// 或者
import * as Form from './form-components'
</script>

<template>
  <!-- 对应第一种引入方式 -->
  <Form>
    <Item />
  </Form>
  <!-- 对应第二种引入方式 -->
  <Form>
    <Form.Item />
  </Form>
</template>
```

:::

如果要定义选项式语法中的其他属性（例如 `name`），可以再定义一个选项式语法的 `script` 块，两者可以共存

::: info
Vue 组件的 `name` 属性有三个作用：

1. 递归组件，可以使用 `name` 或组件文件名对自身进行调用
2. `KeepAlive` 设置缓存需要通过 `name`
3. `devtools` 中显示的组件名称

除此之外无需设置 `name`，在 `3.2.34` 或以上的版本中，使用 `<script setup>` 的单文件组件会自动根据文件名生成对应的 `name` 选项

强烈建议统一使用 `PascalCase` 格式的组件名
:::

## 宏

`<script setup>` 没法接受参数，Vue3 使用宏的方式来实现选项式语法中的功能。在编译过程中，编译器会将宏处理成正确的语法

> 宏（英语：Macro），是一种批量处理的称谓。例如游戏中为某个鼠标、键盘或手柄按键定义宏，就可以通过一个键触发预设的连招

Vue3 提供的宏包括：

- `defineProps`：替换 `props` 选项
- `defineEmits`：替换 `emits` 选项（默认值使用 `withDefaults` 宏）
- `defineModel`（要求 `Vue 3.4+`）：`v-model` 语法糖
- `defineExpose`：替换 `expose` 参数方法
- `defineOptions`：替换组件选项
- `defineSlots`：替换 `slots` 选项
