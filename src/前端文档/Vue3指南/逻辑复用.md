---
sort: 5
---

# 逻辑复用

## 组合式函数

## 渲染函数

Vue 的单文件组件最终会编译为一个组件对象，所以在 JS、TS 文件中直接创建组件对象的方式也能创建组件。为了避免存在多个组件实例时对象值污染的问题，一般使用函数返回组件对象，所以也称为函数式组件

::: tip
这里的函数组件只是一种组件创建方式，不同于 Vue2 中的 `functional` 概念

Vue3 已经删除了 `functional` 选项，因为 2.x 中函数式组件带来的性能提升在 3.x 中已经可以忽略不计
:::

Vue3 为函数组件提供了类型辅助方法 `defineComponent` ，接受同 `script` 中相同的组件选项对象作为参数，且不会对参数做任何修改，只是用于提供类型提示

在 `3.3+` 的版本中，还支持另一种函数签名：以 `setup` 函数作为第一个参数，其他组件选项作为第二个参数。这种使用方式的好处是可以使用泛型定义 `props` 等的类型（但是仍需要在第二个参数选项中手动定义）

```tsx
const Comp = defineComponent(
  <T extends string | number>(props: { msg: T, list: T[] }) => {
    // 就像在 <script setup> 中一样使用组合式 API
    const count = ref(0)

    return () => {
      // 渲染函数或 JSX
      return <div>{count.value}</div>
    }
  },
  // 目前仍然需要手动声明运行时的 props
  {
    props: ['msg', 'list']
  }
)
```

函数组件没有 `template`，如果需要渲染元素需要在 setup 方法中返回一个渲染函数，渲染函数内通过内置的 `h` 函数或者 `JXS/TSX` 创建元素。

`h` 函数也就是 `createVNode` 的别称，用来创建虚拟DOM

`JSX\TSX` 使用前需要先在 `vite` 中添加 `@vitejs/plugin-vue-jsx` 插件，之后对于 `.jsx/tsx` 文件或 `<script lang="jsx/tsx">` 中的 jsx
相关语法便会编译为 `h` 函数

::: tip JSX 使用说明

1. 必须要有一个根元素，可以是空元素`<></>`
2. 使用 `{}` 表示 JS 语法块
3. JSX 中使用 `ref` 值需要带 `.value`
4. 使用 JS 逻辑代替 `v-if`、`v-for` 等
5. 使用 `onEvent` 格式的属性代替 `v-on`；带事件修饰符，使用 `withModifiers` 方法，第一个参数为绑定的事件，第二个参数为事件修饰符数组
6. 支持使用常用的指令：`v-text`、`v-html`、`v-show`、`v-model`
7. 渲染插槽通过调用 setup 方法中 slots 属性中的插槽方法；或使用 renderSlot 方法

:::

除了创建组件对象的方式之外，还可以通过创建返回一个返回 VNode 的函数来实现一个最简单的组件，例如：

```tsx
const comp = () => <h1>comp</h1>
// 等同于
const comp = () => h('h1', null, 'comp')
```

这种组件创建方式在 vue 文件的 `script` 块中也可以使用，可以方便的创建局部复用的小型组件，或配置式的构建某些布局，例如表格和表单

<IframeContainer title="JSX使用" src="https://play.vuejs.org/#eNqNVc1u00AQfpWVT4koDn9CyDhGgHpoD4DaHpDqHjbxJnFZr631uiQKlkDiAAcQEtwqJC6oB26ABEiIpyFFvAWzs2vHpk0hB9u7883sN9/MbObOzSxzDwrmeI6fD2WcKZIzVWSEUzHuh47Kp6EThCJOslQqMieSjUhJRjJNSOiAY+hcr607dMBZZXN7uHQxAmBCMUxFrkiaqRg+SJ/shoJARE4HjHvgsTh6vXj1InTWyChmPNJbgiZwAinXEKofZIk/fny0ePYB8Ga/dhozETFZ70tcdg4oL5hHLpJH5FK3iqWtqpCCoJX0+30A3CCdykqIn2dUkFzNOAM5hilPpUcGAAZZfr354ve0HQQy6C7x/uksWQS+i/ef/vYFkfTbJHt6yotvn3//eHoyZToGPqfmK4pkwOSqhM/pmB+fYIHaZ+81ShZRRaFeUPqOrZmuC/L5/u7n1+e6ZEZ00HeNABl4X6tSqMHHb18uDg+b4AsV+Ko5U0sAqmAfgi6wUCzJOFUMVfJNg3lVC3lIrAc2v9cAOmvQtsB8FI/d/TwV0NuYva5AksWcybsmQOh4lS4gIefpw03cU7JgVkzwmbDhg1P293Vf67TuSZYzebAsAEwNlWOmjHl9+w6bwndtTNKo4IA+w7jF8pQXmqOB3SpEBLQbOGS7gWMXi/FOvj5VTORVUprosolwTm+fkfqS7mX3CvqFogQV6wEGBesLIGKjWGC4VDChTlwGsr4O1Cxj4LC5fb8F6oFy52UhVKxnGx3QSSgmR3TIyAbUEsjBXt35uZKQJowuBHPXOUvgZPSsZ8Ag7J4ZgRswi3YKqJh1ST9YHaesaLApcocsacHx3czWt7RsB3rIdRdmBXd1O3pkiw1TGfnmKGhwMQssogw6BtjJZJrlyMgGJMSM2oTRCEbN4vAOUTJYrmCe0Ne1DNyEZp1ODCwwWsPP+E6CuTa6qGMJYzJpBet2MXGL7jWOglG0iizJwRO6TAE/w0Hnu5rA/xA3i7YQ5mdOtNcy0fF3DdjFgleSVz97q/kqCuYWZ5oAbvPW2nSEvqfxQ0sSBa1g5WpN2qLYMzsnE9dz085d17URFnasmO2zWo7mNJxifNcKoZAe/H86ugL6Qg0dK2vo7Fk0BjYhnPIPUP6Q+g==" />

## Inject、Provide

## 自定义指令
